<!DOCTYPE html>

<html>
	<head>
		<meta charset="UTF-8">
		<title>FMS_Cat.log</title>
		<link href='http://fonts.googleapis.com/earlyaccess/notosansjapanese.css' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
		<style type="text/css">
			*
			{
				font-family:'Noto Sans Japanese',sans-serif;
				line-height:1.5;
				overflow-x:hidden;
			}

			body
			{
				background:#222;
				color:#fff;
			}

			a
			{
				text-decoration:none;
				color:#fc9;
			}

			ul
			{
				list-style-type:square;
			}

			li
			{
				overflow-x:visible;
			}

			code
			{
				font-family:'Ubuntu Mono',monospace;
				padding:1px;
				background:#444;
				border:1px solid #666;
				border-radius:2px;
			}

			.logs
			{
				position:absolute;
				width:100%;
				top:48px;
				margin-bottom:16px;
			}

			.log
			{
				background:#333;
				margin:16px;
				padding:16px;
			}

			.time
			{
				margin:4px 12px;
				color:#999;
			}

			.title
			{
				margin:-8px 12px;
				color:#ccc;
				font-size:32px;
				cursor:pointer;
			}

			.tags
			{
				margin:0px 8px;
			}

			.tag
			{
				margin:4px;
				padding:4px;
				background:#555;
				font-size:10px;
				border-radius:2px;
				cursor:pointer;
			}

			.text
			{
				margin:12px 32px 12px 32px;
			}

			.balloony
			{
				padding:1px;
				background:#624;
				border:1px solid #936;
				border-radius:2px;
			}

			#balloonD
			{
				position:fixed;
				z-index:4;
			}

			#balloon
			{
				background:#222;
				opacity:0;
				padding:0px 4px;
				border-radius:2px;
				white-space:nowrap;
				z-index:4;
			}

			#head
			{
				font-size:32px;
				position:fixed;
				right:0px;
				top:0px;
				width:100%;
				background:#444;
				color:#fff;
				z-index:2;
				cursor:pointer;
			}

			#headTitle
			{
				opacity:.8;
				font-size:32px;
				z-index:2;
				padding:8px;
				overflow:visible;
			}

			#foot
			{
				font-size:12px;
				text-align:center;
				position:fixed;
				right:0px;
				bottom:0px;
				width:100%;
				background:#444;
				z-index:2;
			}

			#cat
			{
				position:fixed;
				right:-20px;
				bottom:-20px;
				width:120px;
				height:120px;
				border-radius:50%;
				transform:rotate(-10deg);
				z-index:3;
			}
		</style>
	</head>
	<body>
		<div id="head"><span id="headTitle">FMS_Cat.log</span></div>
		<div id="balloonD"><div id="balloon"></div></div>
		<div id="foot">
			<a href="http://fms-cat.github.io/" target="_blank">Homepage</a> -
			<a href="https://github.com/FMS-cat/log" target="_blank">Repository</a> -
			2015 FMS_Cat
		</div>
		<a href="https://twitter.com/FMS_Cat" target="_blank"><image src="cat.gif" id="cat"></image></a>
		<script src="jquery.js"></script>
		<script src="jquery.easing.js"></script>
		<script src="jquery.color.js"></script>
		<script src="marked.js"></script>
		<script>
			$(function(){
				marked.setOptions({
					gfm:true,
					breaks:true,
				});

				var firstHref=/#.*/.exec(location.href);
				if(firstHref){
					query(firstHref[0]);
					history.replaceState(firstHref[0]);
				}else{
					query('');
					history.replaceState('');
				}

				$(window).on('popstate',function(e){
					query(e.originalEvent.state);
				});

				$(document).on('mouseenter.zoomCat','#cat',function(e){
					$('#cat').attr('src','catAni.gif');
					$('#cat').stop().animate({width:180,height:180,right:-30,bottom:-30},200,'easeOutCubic');
				});

				$(document).on('mouseleave.unzoomCat','#cat',function(e){
					$('#cat').attr('src','cat.gif');
					$('#cat').stop().animate({width:120,height:120,right:-20,bottom:-20},200,'easeOutCubic');
				});

				$(document).on('mouseenter.aColorOn','a',function(e){
					$(this).stop().animate({color:"#f93"},100);
				});

				$(document).on('mouseleave.aColorOff','a',function(e){
					$(this).stop().animate({color:"#fc9"},100);
				});

				$(document).on('click.headTitleSelect','#headTitle',function(e){
					time = $(this).attr('time');
					history.pushState('','','http://fms-cat.github.io/log/');
					loadPage(0);
				});

				$(document).on('mouseenter.headTitleColorOn','#headTitle',function(e){
					$(this).stop().fadeTo(100,1);
				});

				$(document).on('mouseleave.headTitleColorOff','#headTitle',function(e){
					$(this).stop().fadeTo(100,.8);
				});

				$(document).on('click.titleSelect','.title',function(e){
					time = $(this).attr('time');
					history.pushState('#time/'+time,'','#time/'+time);
					loadTime(time);
				});

				$(document).on('mouseenter.titleColorOn','.title',function(e){
					$(this).stop().animate({color:"#fff"},100);
				});

				$(document).on('mouseleave.titleColorOff','.title',function(e){
					$(this).stop().animate({color:"#ccc"},100);
				});

				$(document).on('click.tagSelect','.tag',function(e){
					tag = $(this).html();
					history.pushState('#tag/'+tag,'','#tag/'+tag);
					loadTag(tag);
				});

				$(document).on('mouseenter.tagBgOn','.tag',function(e){
					$(this).stop().animate({backgroundColor:"#777"},100);
				});

				$(document).on('mouseleave.tagBgOff','.tag',function(e){
					$(this).stop().animate({backgroundColor:"#555"},100);
				});

				$(document).on('mouseenter.balloonyBgOn','.balloony',function(e){
					$(this).stop().animate({backgroundColor:"#936"},100);
				});

				$(document).on('mouseleave.balloonyBgOff','.balloony',function(e){
					$(this).stop().animate({backgroundColor:"#624"},100);
				});

				$(document).on('mouseenter.showBalloon','[balloon]',function(e){
					$('#balloon').html($(this).attr('balloon'));
					$('#balloon').stop().fadeTo(100,.8);
				});

				$(document).on('mouseleave.hideBalloon','[balloon]',function(e){
					$('#balloon').stop().fadeTo(100,0);
				});

				$(document).on('mousemove.moveBalloon',function(e){
					$("#balloonD").animate({left:e.clientX+8},0);
					$("#balloonD").animate({top:Math.min(e.clientY+8,$(window).height()-32)},0);
				});

				function appendLog(_log,_logsDiv){
					var logDiv = $('<div class="log">');
					$(logDiv).append($('<span class="time">').html(new Date(_log.time)));
					$(logDiv).append('<br>');
					$(logDiv).append($('<span class="title" time="'+_log.time+'">').html(_log.title));
					var tagsDiv = $('<div class="tags">');
					$.each(_log.tags,function(_i,_tag){
						$(tagsDiv).append($('<span class="tag">').html(_tag));
					});
					$(logDiv).append(tagsDiv);
					$.get('log/'+_log.time+'.html',function(html){
						$(logDiv).append($('<div class="text">').html(marked(html)));
					});
					$(_logsDiv).append(logDiv);
				}

				function newPage(){
					$('.logs').addClass('logsOld');
					$('.logs').removeClass('logsNew');
					var logsDiv = $('<div class="logs logsNew">');
					logsDiv.css({left:-$(window).width()});
					$('body').append(logsDiv);
					$('.logsOld').animate({left:$(window).width()},300,'easeOutCubic',function(){
						$('.logsOld').remove();
					});
					$('.logsNew').animate({left:0},300,'easeOutCubic');
					$('html,body').animate({scrollTop:0},300,'easeOutCubic');
					return logsDiv;
				}

				function query(_i){
					if(_i == ''){loadPage(0); return;}
					var a = _i.split('/');
					switch(a[0]){
						case '#page': loadPage(a[1]); break;
						case '#time': loadTime(a[1]); break;
						case '#tag': loadTag(a[1]); break;
					}
				}

				function loadPage(_page){
					logsDiv = newPage();
					$.getJSON('logs.json',function(_logs){
						_logs.sort(function(_a,_b){
							return _b.time - _a.time;
						});
						$.each(_logs,function(_i,_log){
							if(5*_page<=_i&&_i<5+5*_page){
								appendLog(_log,logsDiv);
							}
						});
					});
				}

				function loadTime(_time){
					logsDiv = newPage();
					$.getJSON('logs.json',function(_logs){
						$.each(_logs,function(_i,_log){
							if(_log.time == _time){
								appendLog(_log,logsDiv);
								return false; // break
							}
						});
					});
				}

				function loadTag(_tag){
					logsDiv = newPage();
					$.getJSON('logs.json',function(_logs){
						_logs.sort(function(_a,_b){
							return _b.time - _a.time;
						});
						$.each(_logs,function(_i,_log){
							if($.inArray(_tag,_log.tags) != -1){
								appendLog(_log,logsDiv);
							}
						});
					});
				}
			});
		</script>
	</body>
</html>
